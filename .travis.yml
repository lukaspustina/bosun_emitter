language: rust
rust:
- stable
- beta
- nightly
branches:
  only:
  - master
  - travis-ci
  - "/^v.*$/"
os:
- linux
- osx
matrix:
  allow_failures:
  - rust: nightly
after_success: |
  [ $TRAVIS_OS_NAME = linux ] &&
  [ $TRAVIS_RUST_VERSION = stable ] &&
  [ $TRAVIS_BRANCH = master ] &&
  [ $TRAVIS_PULL_REQUEST = false ] &&
  cargo doc --no-deps &&
  echo '<meta http-equiv=refresh content=0;url=bosun_emitter/index.html>' > target/doc/index.html &&
  pip install --user ghp-import &&
  /home/travis/.local/bin/ghp-import -n target/doc &&
  git push -fq https://${GITHUB_TOKEN}@github.com/${TRAVIS_REPO_SLUG}.git gh-pages
before_deploy:
- cd /home/travis/build/lukaspustina/bosun_emitter; cargo build --release
- cd /home/travis/build/lukaspustina; git clone https://github.com/lukaspustina/bosun_emitter-deb.git
- cd /home/travis/build/lukaspustina/bosun_emitter-deb; BIN_DIR=../bosun_emitter/target/release ARCH=amd64 VERSION=$TRAVIS_TAG TAG=$TRAVIS_TAG DIST=trusty make package
deploy:
  provider: packagecloud
  username: lukaspustina
  token:
    secure: LFbmfH3/FoqqAdcyPgK/gN4JuDf/l28p0+OkpvEHLJkHIBnYdgDev7Cr+ni8prda79WKqC76yTIfWCVnR0EmJpBpUsn71iNjTstnF+2AD5GKH/6GhKaotoYujDLJXSWBSc6Ci3XH/sEzbwbiaLKefOmnsk6xSrxTdziadIC4Kn6k9otUp6eZSpTEK9JOvWxymIj23HsRgv//qX5OPB54IurnodKK3m2uOTgOdFCJckfYppo7a03uiLjdoTPjLg4ppIeDSbzKeAoh9arEVwKlRpFBOw/dDcqnRuoJQMI2BmC5qXKt1UCbg5ucUJcJHwYEXBKdmSy1euUZiMOVaCdadf+pcuiPq+3x0DBrk7j7Inq1mKokm8QGYn6YmO7/D613Y5dKY/mNwWeaodKPlP20WGXdJQ4q3bkye9YVG/XrZas6TLgKXm1KpvlreJuToFS0/Pd+Pziy+xtOzQUBxK1jm4gZEMH2ckRGX4I54RU0Zg+/6e6884VK9nvdswWKYsHpsLlsQCfH+ypZhLU6atHM4tAhk1qenzNXTcTYOASHz95UzDpB8XaQ45UYPPqEwOFzwI71nvFSwKjuVNpnWvAGJxInk7XsuHuDpfte5dp0/g/L/SqKruJFfsbvnrKR6L+bNLMWMIogoOdzhCASjofo6pTcODiPSmmJE9R8b4OQ9jg=
  repository: opensource
  dist: ubuntu/trusty
  package_glob: "**/*.deb"
  skip_cleanup: true
  on:
    tags: true
    condition:
    - "$TRAVIS_OS_NAME == linux"
    - "$TRAVIS_RUST_VERSION == stable"
env:
  global:
    secure: QIuMZyJm4gxKGoXPcd8xb6DWOwHWXOnLRjddM1p/X1byatS2+37qMVJ3c4jsj8vCh2XC+0t1v+Vj61/+VdO4C7M6uPY7fcBMPwNdLzmkrJqyTtDGMSzM18FrJa1iQ3CPyD2JPbb568y3/lmKxmwBxiLBPX4d5GflrJF1leOSqs6Y8LdCYzQe8b+qyTJt5b2cscp6/5td7ObmIaxnbPjtAMdW99t09ljhz4OKtBCsQCM+VeiOT3QiNTO1rsM1yZbC8Qv5B84yhYiCO2QGM56SHBlQb8htpaVePu7RKeYU+SyE+EPR3xjjMcR0mlm6WkAetokNoK55gnb1Cd0KYUrhyAWMvJxvYSkFI5NMGUIgLm+grtKe/oyr5A9cM3SvAxAdKXjjl1CtLEYeoHotgH1pdsdSBtSx7n2W9ozMd2JjVGKu8+DlhW4lY2fgtXiKFqojSy9aislB4UDOE3yA/Audsq8C8pavUNwaS1H4I5bfJ98liv8ibgL5jl25OdbSzqc9crelIA3XWglj8Hc2jHdLx2QpHG4NdR0O/WX7/Ccw7wq1Z+GHCfdz86NUEOypnr+MTxPV7R1tsQBH8DAq7itx24EqNZkDoULmPiflDdc6o48Ns0GKBftdMSZ/YU+RGbVuybHieXGlnr/1gYzUMP30x2QIVvO19sTDv8BhXQOBV9M=
